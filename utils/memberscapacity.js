// let capacityDashboard = {
//     DepartmentCapacityRows:[
//         {department:"", capacityHrs:0, availableHrs:0, allocatedHrs:0},
//         {department:"", capacityHrs:0, availableHrs:0, allocatedHrs:0},
//         {department:"", capacityHrs:0, availableHrs:0, allocatedHrs:0},{},{},
//     ],
//     DeptartmentCapcityMonthRows:[
//         {department:"",months:[
//             {monthName:"", days: 0, capacityHrs:0, allocatedHrs:0},
//             {monthName:"", days: 0, capacityHrs:0, allocatedHrs:0},
//             {monthName:"", days: 0, capacityHrs:0, allocatedHrs:0},{},{},
//         ]},
//         {department:"",months:[
//             {monthName:"", days: 0, capacityHrs:0, allocatedHrs:0},
//             {monthName:"", days: 0, capacityHrs:0, allocatedHrs:0},
//             {monthName:"", days: 0, capacityHrs:0, allocatedHrs:0},{},{},
//         ]},
//         {},{},{},
//     ],
//     TeamMemberCapacityRows:[
//         {memberName:"", allocatedHrs:0, availableHrs: 0, allocatedPercent: 0},
//         {memberName:"", allocatedHrs:0, availableHrs: 0, allocatedPercent: 0},
//         {memberName:"", allocatedHrs:0, availableHrs: 0, allocatedPercent: 0},{},{}
//     ],
//     ProjectTeamMemberCapacityRows: [
//         {
//             memberName:"", 
//             allocatedProjectHrs:[
//                 {projectName: "", hrsTime: 0},
//                 {projectName: "", hrsTime: 0},
//                 {projectName: "", hrsTime: 0},{},{},
//             ]
//         },
//         {
//             memberName:"",
//             allocatedProjectHrs:[
//                 {projectName: "", hrsTime: 0},
//                 {projectName: "", hrsTime: 0},
//                 {projectName: "", hrsTime: 0},{},{},
//             ]
//         },{},{},{},
//     ]
// }
// let allmemberslist= [
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "_id": "6802242587c5dbbc2fd51f15",
//       "memberslist": [
//         {
//           "memberid": "memb1",
//           "memberName": "A",
//           "memberRole": "1",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 50,
//           "_id": "6802242587c5dbbc2fd51f16"
//         },
//         {
//           "memberid": "memb2",
//           "memberName": "B",
//           "memberRole": "2",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 40,
//           "_id": "6802242587c5dbbc2fd51f17"
//         },
//         {
//           "memberid": "memb3",
//           "memberName": "C",
//           "memberRole": "3",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 55,
//           "_id": "6802242587c5dbbc2fd51f18"
//         },
//         {
//           "memberid": "memb1",
//           "memberName": "Radha",
//           "memberRole": "A",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 40,
//           "_id": "6802811103a8743bd8ea8d5e"
//         },
//         {
//           "memberid": "memb2",
//           "memberName": "Syed",
//           "memberRole": "Dev Head",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 50,
//           "_id": "6802811103a8743bd8ea8d5f"
//         },
//         {
//           "memberid": "memb3",
//           "memberName": "Ram",
//           "memberRole": "Sr Dev",
//           "memberDepartment": "Product",
//           "memberCostperhrs": 40,
//           "_id": "6802811103a8743bd8ea8d60"
//         },
//         {
//           "memberid": "memb4",
//           "memberName": "Danie",
//           "memberRole": "Designer",
//           "memberDepartment": "Design",
//           "memberCostperhrs": 35,
//           "_id": "6802811103a8743bd8ea8d61"
//         },
//         {
//           "memberid": "memb5",
//           "memberName": "Siva",
//           "memberRole": "Engineer",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 40,
//           "_id": "6802811103a8743bd8ea8d62"
//         },
//         {
//           "memberid": "memb6",
//           "memberName": "Sampurna",
//           "memberRole": "Delivery Head",
//           "memberDepartment": "Others",
//           "memberCostperhrs": 60,
//           "_id": "6802811103a8743bd8ea8d63"
//         },
//         {
//           "memberid": "memb7",
//           "memberName": "Arun",
//           "memberRole": "Acc Manager",
//           "memberDepartment": "Others",
//           "memberCostperhrs": 30,
//           "_id": "6802811103a8743bd8ea8d64"
//         },
//         {
//           "memberid": "memb8",
//           "memberName": "Sangeetha",
//           "memberRole": "Consultant",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 40,
//           "_id": "6802811103a8743bd8ea8d65"
//         },
//         {
//           "memberid": "memb9",
//           "memberName": "Saranya",
//           "memberRole": "Tester",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 40,
//           "_id": "6802811103a8743bd8ea8d66"
//         },
//         {
//           "memberid": "memb10",
//           "memberName": "Radhika",
//           "memberRole": "Support",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 40,
//           "_id": "6802811103a8743bd8ea8d67"
//         },
//         {
//           "memberid": "memb1",
//           "memberName": "Syed",
//           "memberRole": "Dev Head",
//           "memberDepartment": "Engineer",
//           "memberCostperhrs": 40,
//           "_id": "680b37642b24c967cafecf4e"
//         },
//         {
//           "memberid": "memb1",
//           "memberName": "Ram",
//           "memberRole": "Sr Dev",
//           "memberDepartment": "Product",
//           "memberCostperhrs": 40,
//           "_id": "680b82822f2f323d364d1e53"
//         },
//         {
//           "memberid": "memb2",
//           "memberName": "Sampurna",
//           "memberRole": "Delivery Head",
//           "memberDepartment": "Others",
//           "memberCostperhrs": 70,
//           "_id": "680b82822f2f323d364d1e54"
//         },
//         {
//           "memberid": "memb2",
//           "memberName": "Danie",
//           "memberRole": "Designer",
//           "memberDepartment": "Design",
//           "memberCostperhrs": 35,
//           "_id": "680f8c2f6f5619a232b38c4c"
//         },
//         {
//           "memberid": "memb3",
//           "memberName": "Sampurna",
//           "memberRole": "Delivery Head",
//           "memberDepartment": "Others",
//           "memberCostperhrs": 60,
//           "_id": "680f8c2f6f5619a232b38c4d"
//         }
//       ],
//       "__v": 5
//     }
//   ];
// let allprojectslist = [
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "projectDetails": {
//         "projectTitle": "Test",
//         "projectDescription": "test",
//         "projectinput": {
//           "startDate": "2025-04-18T00:00:00.000Z",
//           "workHours": 8,
//           "totalProjectHours": 100,
//           "profitTarget": 27.5,
//           "teamMemberCount": 3,
//           "workWeekDays": "5",
//           "teamMembers": [
//             {
//               "id": "memb1",
//               "name": "A",
//               "role": "1",
//               "department": "Engineer",
//               "hours_day": 4,
//               "cost_rate": 50,
//               "billable_rate": 20,
//               "billable_ratio": 100,
//               "_id": "6802242487c5dbbc2fd51f09"
//             },
//             {
//               "id": "memb2",
//               "name": "B",
//               "role": "2",
//               "department": "Market",
//               "hours_day": 4,
//               "cost_rate": 40,
//               "billable_rate": 40,
//               "billable_ratio": 100,
//               "_id": "6802242487c5dbbc2fd51f0a"
//             },
//             {
//               "id": "memb3",
//               "name": "C",
//               "role": "3",
//               "department": "Engineer",
//               "hours_day": 4,
//               "cost_rate": 55,
//               "billable_rate": 20,
//               "billable_ratio": 100,
//               "_id": "6802242487c5dbbc2fd51f0b"
//             }
//           ],
//           "_id": "6802242487c5dbbc2fd51f08"
//         },
//         "projectoutput": {
//           "teamCostBreakdown": {
//             "memberCostBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "A",
//                 "role": "1",
//                 "cost_rate": 50,
//                 "total_hours": 33.2,
//                 "member_cost": 1660.0000000000002,
//                 "_id": "6802242487c5dbbc2fd51f0d"
//               },
//               {
//                 "id": "memb2",
//                 "name": "B",
//                 "role": "2",
//                 "cost_rate": 40,
//                 "total_hours": 33.2,
//                 "member_cost": 1328,
//                 "_id": "6802242487c5dbbc2fd51f0e"
//               },
//               {
//                 "id": "memb3",
//                 "name": "C",
//                 "role": "3",
//                 "cost_rate": 55,
//                 "total_hours": 33.2,
//                 "member_cost": 1826.0000000000002,
//                 "_id": "6802242487c5dbbc2fd51f0f"
//               }
//             ],
//             "totalCosts": 4814
//           },
//           "revenueBreakdown": {
//             "memberRevenueBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "A",
//                 "role": "1",
//                 "billable_rate": 20,
//                 "billable_ratio": 100,
//                 "billable_hours": 33.2,
//                 "revenue": 664,
//                 "_id": "6802242487c5dbbc2fd51f10"
//               },
//               {
//                 "id": "memb2",
//                 "name": "B",
//                 "role": "2",
//                 "billable_rate": 40,
//                 "billable_ratio": 100,
//                 "billable_hours": 33.2,
//                 "revenue": 1328,
//                 "_id": "6802242487c5dbbc2fd51f11"
//               },
//               {
//                 "id": "memb3",
//                 "name": "C",
//                 "role": "3",
//                 "billable_rate": 20,
//                 "billable_ratio": 100,
//                 "billable_hours": 33.2,
//                 "revenue": 664,
//                 "_id": "6802242487c5dbbc2fd51f12"
//               }
//             ],
//             "totalRevenue": 2656
//           },
//           "teamDailyCapacity": 12,
//           "projectedDuration": 8.3,
//           "projectedEndDate": "2025-04-30T00:00:00.000Z",
//           "averageBillableRatio": 100,
//           "teamCosts": 4814,
//           "mainRevenue": 6640,
//           "profitLoss": 1826,
//           "profitMargin": 27.500000000000004,
//           "_id": "6802242487c5dbbc2fd51f0c"
//         }
//       },
//       "_id": "6802242487c5dbbc2fd51f07",
//       "__v": 0
//     },
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "projectDetails": {
//         "projectTitle": "Test 2",
//         "projectDescription": "test 2",
//         "projectinput": {
//           "startDate": "2025-03-04T00:00:00.000Z",
//           "workHours": 10,
//           "totalProjectHours": 1000,
//           "profitTarget": 30,
//           "teamMemberCount": 10,
//           "workWeekDays": "6",
//           "teamMembers": [
//             {
//               "id": "memb1",
//               "name": "Radha",
//               "role": "CEO",
//               "department": "Others",
//               "hours_day": 0.25,
//               "cost_rate": 90,
//               "billable_rate": 40,
//               "billable_ratio": 0,
//               "_id": "6802811103a8743bd8ea8d3b"
//             },
//             {
//               "id": "memb2",
//               "name": "Syed",
//               "role": "Dev Head",
//               "department": "Engineer",
//               "hours_day": 2,
//               "cost_rate": 50,
//               "billable_rate": 65,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d3c"
//             },
//             {
//               "id": "memb3",
//               "name": "Ram",
//               "role": "Sr Dev",
//               "department": "Engineer",
//               "hours_day": 3,
//               "cost_rate": 42,
//               "billable_rate": 85,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d3d"
//             },
//             {
//               "id": "memb4",
//               "name": "Danie",
//               "role": "Designer",
//               "department": "Design",
//               "hours_day": 1,
//               "cost_rate": 35,
//               "billable_rate": 45,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d3e"
//             },
//             {
//               "id": "memb5",
//               "name": "Siva",
//               "role": "Engineer",
//               "department": "Engineer",
//               "hours_day": 3,
//               "cost_rate": 40,
//               "billable_rate": 60,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d3f"
//             },
//             {
//               "id": "memb6",
//               "name": "Sampurna",
//               "role": "Delivery Head",
//               "department": "Others",
//               "hours_day": 1,
//               "cost_rate": 60,
//               "billable_rate": 80,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d40"
//             },
//             {
//               "id": "memb7",
//               "name": "Arun",
//               "role": "Acc Manager",
//               "department": "Others",
//               "hours_day": 0.5,
//               "cost_rate": 30,
//               "billable_rate": 25,
//               "billable_ratio": 10,
//               "_id": "6802811103a8743bd8ea8d41"
//             },
//             {
//               "id": "memb8",
//               "name": "Sangeetha",
//               "role": "Consultant",
//               "department": "Engineer",
//               "hours_day": 2,
//               "cost_rate": 40,
//               "billable_rate": 60,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d42"
//             },
//             {
//               "id": "memb9",
//               "name": "Saranya",
//               "role": "Tester",
//               "department": "Engineer",
//               "hours_day": 2.5,
//               "cost_rate": 40,
//               "billable_rate": 60,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d43"
//             },
//             {
//               "id": "memb10",
//               "name": "Radhika",
//               "role": "Support",
//               "department": "Engineer",
//               "hours_day": 1.5,
//               "cost_rate": 40,
//               "billable_rate": 60,
//               "billable_ratio": 100,
//               "_id": "6802811103a8743bd8ea8d44"
//             }
//           ],
//           "_id": "6802811103a8743bd8ea8d3a"
//         },
//         "projectoutput": {
//           "teamCostBreakdown": {
//             "memberCostBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Radha",
//                 "role": "CEO",
//                 "cost_rate": 90,
//                 "total_hours": 14.925,
//                 "member_cost": 1343.25,
//                 "_id": "6802811103a8743bd8ea8d46"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "cost_rate": 50,
//                 "total_hours": 119.4,
//                 "member_cost": 5970,
//                 "_id": "6802811103a8743bd8ea8d47"
//               },
//               {
//                 "id": "memb3",
//                 "name": "Ram",
//                 "role": "Sr Dev",
//                 "cost_rate": 42,
//                 "total_hours": 179.10000000000002,
//                 "member_cost": 7522.200000000001,
//                 "_id": "6802811103a8743bd8ea8d48"
//               },
//               {
//                 "id": "memb4",
//                 "name": "Danie",
//                 "role": "Designer",
//                 "cost_rate": 35,
//                 "total_hours": 59.7,
//                 "member_cost": 2089.5,
//                 "_id": "6802811103a8743bd8ea8d49"
//               },
//               {
//                 "id": "memb5",
//                 "name": "Siva",
//                 "role": "Engineer",
//                 "cost_rate": 40,
//                 "total_hours": 179.10000000000002,
//                 "member_cost": 7164.000000000001,
//                 "_id": "6802811103a8743bd8ea8d4a"
//               },
//               {
//                 "id": "memb6",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "cost_rate": 60,
//                 "total_hours": 59.7,
//                 "member_cost": 3582,
//                 "_id": "6802811103a8743bd8ea8d4b"
//               },
//               {
//                 "id": "memb7",
//                 "name": "Arun",
//                 "role": "Acc Manager",
//                 "cost_rate": 30,
//                 "total_hours": 29.85,
//                 "member_cost": 895.5,
//                 "_id": "6802811103a8743bd8ea8d4c"
//               },
//               {
//                 "id": "memb8",
//                 "name": "Sangeetha",
//                 "role": "Consultant",
//                 "cost_rate": 40,
//                 "total_hours": 119.4,
//                 "member_cost": 4776,
//                 "_id": "6802811103a8743bd8ea8d4d"
//               },
//               {
//                 "id": "memb9",
//                 "name": "Saranya",
//                 "role": "Tester",
//                 "cost_rate": 40,
//                 "total_hours": 149.25,
//                 "member_cost": 5970,
//                 "_id": "6802811103a8743bd8ea8d4e"
//               },
//               {
//                 "id": "memb10",
//                 "name": "Radhika",
//                 "role": "Support",
//                 "cost_rate": 40,
//                 "total_hours": 89.55000000000001,
//                 "member_cost": 3582.0000000000005,
//                 "_id": "6802811103a8743bd8ea8d4f"
//               }
//             ],
//             "totalCosts": 42894.45
//           },
//           "revenueBreakdown": {
//             "memberRevenueBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Radha",
//                 "role": "CEO",
//                 "billable_rate": 40,
//                 "billable_ratio": 0,
//                 "billable_hours": 0,
//                 "revenue": 0,
//                 "_id": "6802811103a8743bd8ea8d50"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "billable_rate": 65,
//                 "billable_ratio": 100,
//                 "billable_hours": 119.4,
//                 "revenue": 7761,
//                 "_id": "6802811103a8743bd8ea8d51"
//               },
//               {
//                 "id": "memb3",
//                 "name": "Ram",
//                 "role": "Sr Dev",
//                 "billable_rate": 85,
//                 "billable_ratio": 100,
//                 "billable_hours": 179.10000000000002,
//                 "revenue": 15223.500000000002,
//                 "_id": "6802811103a8743bd8ea8d52"
//               },
//               {
//                 "id": "memb4",
//                 "name": "Danie",
//                 "role": "Designer",
//                 "billable_rate": 45,
//                 "billable_ratio": 100,
//                 "billable_hours": 59.7,
//                 "revenue": 2686.5,
//                 "_id": "6802811103a8743bd8ea8d53"
//               },
//               {
//                 "id": "memb5",
//                 "name": "Siva",
//                 "role": "Engineer",
//                 "billable_rate": 60,
//                 "billable_ratio": 100,
//                 "billable_hours": 179.10000000000002,
//                 "revenue": 10746.000000000002,
//                 "_id": "6802811103a8743bd8ea8d54"
//               },
//               {
//                 "id": "memb6",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "billable_rate": 80,
//                 "billable_ratio": 100,
//                 "billable_hours": 59.7,
//                 "revenue": 4776,
//                 "_id": "6802811103a8743bd8ea8d55"
//               },
//               {
//                 "id": "memb7",
//                 "name": "Arun",
//                 "role": "Acc Manager",
//                 "billable_rate": 25,
//                 "billable_ratio": 10,
//                 "billable_hours": 2.9850000000000003,
//                 "revenue": 74.62500000000001,
//                 "_id": "6802811103a8743bd8ea8d56"
//               },
//               {
//                 "id": "memb8",
//                 "name": "Sangeetha",
//                 "role": "Consultant",
//                 "billable_rate": 60,
//                 "billable_ratio": 100,
//                 "billable_hours": 119.4,
//                 "revenue": 7164,
//                 "_id": "6802811103a8743bd8ea8d57"
//               },
//               {
//                 "id": "memb9",
//                 "name": "Saranya",
//                 "role": "Tester",
//                 "billable_rate": 60,
//                 "billable_ratio": 100,
//                 "billable_hours": 149.25,
//                 "revenue": 8955,
//                 "_id": "6802811103a8743bd8ea8d58"
//               },
//               {
//                 "id": "memb10",
//                 "name": "Radhika",
//                 "role": "Support",
//                 "billable_rate": 60,
//                 "billable_ratio": 100,
//                 "billable_hours": 89.55000000000001,
//                 "revenue": 5373.000000000001,
//                 "_id": "6802811103a8743bd8ea8d59"
//               }
//             ],
//             "totalRevenue": 62759.625
//           },
//           "teamDailyCapacity": 16.75,
//           "projectedDuration": 59.7,
//           "projectedEndDate": "2025-05-12T00:00:00.000Z",
//           "averageBillableRatio": 81,
//           "teamCosts": 42894.45,
//           "mainRevenue": 62759.625,
//           "profitLoss": 19865.175000000003,
//           "profitMargin": 31.652794292508922,
//           "_id": "6802811103a8743bd8ea8d45"
//         }
//       },
//       "_id": "6802811103a8743bd8ea8d39",
//       "__v": 0
//     },
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "projectDetails": {
//         "projectTitle": "Test 3",
//         "projectDescription": "test",
//         "projectinput": {
//           "startDate": "2025-04-18T00:00:00.000Z",
//           "workHours": 8,
//           "totalProjectHours": 100,
//           "profitTarget": 25,
//           "teamMemberCount": 1,
//           "workWeekDays": "5",
//           "teamMembers": [
//             {
//               "id": "memb1",
//               "name": "Radha",
//               "role": "A",
//               "department": "Engineer",
//               "hours_day": 4,
//               "cost_rate": 40,
//               "billable_rate": 40,
//               "billable_ratio": 100,
//               "_id": "6802866503a8743bd8ea8f2a"
//             }
//           ],
//           "_id": "6802866503a8743bd8ea8f29"
//         },
//         "projectoutput": {
//           "teamCostBreakdown": {
//             "memberCostBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Radha",
//                 "role": "A",
//                 "cost_rate": 40,
//                 "total_hours": 100,
//                 "member_cost": 4000,
//                 "_id": "6802866503a8743bd8ea8f2c"
//               }
//             ],
//             "totalCosts": 4000
//           },
//           "revenueBreakdown": {
//             "memberRevenueBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Radha",
//                 "role": "A",
//                 "billable_rate": 40,
//                 "billable_ratio": 100,
//                 "billable_hours": 100,
//                 "revenue": 4000,
//                 "_id": "6802866503a8743bd8ea8f2d"
//               }
//             ],
//             "totalRevenue": 4000
//           },
//           "teamDailyCapacity": 4,
//           "projectedDuration": 25,
//           "projectedEndDate": "2025-05-22T00:00:00.000Z",
//           "averageBillableRatio": 100,
//           "teamCosts": 4000,
//           "mainRevenue": 5333.333333333333,
//           "profitLoss": 1333.333333333333,
//           "profitMargin": 24.999999999999993,
//           "_id": "6802866503a8743bd8ea8f2b"
//         }
//       },
//       "_id": "6802866503a8743bd8ea8f28",
//       "__v": 0
//     },
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "projectDetails": {
//         "projectTitle": "Project A ",
//         "projectDescription": "",
//         "projectinput": {
//           "startDate": "2025-04-25T00:00:00.000Z",
//           "workHours": 8,
//           "totalProjectHours": 100,
//           "profitTarget": 25,
//           "teamMemberCount": 1,
//           "workWeekDays": "5",
//           "teamMembers": [
//             {
//               "id": "memb1",
//               "name": "Syed",
//               "role": "Dev Head",
//               "department": "Engineer",
//               "hours_day": 4,
//               "cost_rate": 50,
//               "billable_rate": 40,
//               "billable_ratio": 100,
//               "_id": "680b37632b24c967cafecf3c"
//             }
//           ],
//           "_id": "680b37632b24c967cafecf3b"
//         },
//         "projectoutput": {
//           "teamCostBreakdown": {
//             "memberCostBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "cost_rate": 50,
//                 "total_hours": 100,
//                 "member_cost": 5000,
//                 "_id": "680b37632b24c967cafecf3e"
//               }
//             ],
//             "totalCosts": 5000
//           },
//           "revenueBreakdown": {
//             "memberRevenueBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "billable_rate": 40,
//                 "billable_ratio": 100,
//                 "billable_hours": 100,
//                 "revenue": 4000,
//                 "_id": "680b37632b24c967cafecf3f"
//               }
//             ],
//             "totalRevenue": 4000
//           },
//           "teamDailyCapacity": 4,
//           "projectedDuration": 25,
//           "projectedEndDate": "2025-05-29T00:00:00.000Z",
//           "averageBillableRatio": 100,
//           "teamCosts": 5000,
//           "mainRevenue": 6666.666666666667,
//           "profitLoss": 1666.666666666667,
//           "profitMargin": 25.000000000000007,
//           "_id": "680b37632b24c967cafecf3d"
//         }
//       },
//       "_id": "680b37632b24c967cafecf3a",
//       "__v": 0
//     },
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "projectDetails": {
//         "projectTitle": "Radha's Creator Project",
//         "projectDescription": "",
//         "projectinput": {
//           "startDate": "2025-05-01T00:00:00.000Z",
//           "workHours": 6,
//           "totalProjectHours": 200,
//           "profitTarget": 40,
//           "teamMemberCount": 2,
//           "workWeekDays": "5",
//           "teamMembers": [
//             {
//               "id": "memb1",
//               "name": "Ram",
//               "role": "Sr Dev",
//               "department": "Product",
//               "hours_day": 6,
//               "cost_rate": 40,
//               "billable_rate": 75,
//               "billable_ratio": 90,
//               "_id": "680b82812f2f323d364d1e3d"
//             },
//             {
//               "id": "memb2",
//               "name": "Sampurna",
//               "role": "Delivery Head",
//               "department": "Others",
//               "hours_day": 2,
//               "cost_rate": 70,
//               "billable_rate": 90,
//               "billable_ratio": 80,
//               "_id": "680b82812f2f323d364d1e3e"
//             }
//           ],
//           "_id": "680b82812f2f323d364d1e3c"
//         },
//         "projectoutput": {
//           "teamCostBreakdown": {
//             "memberCostBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Ram",
//                 "role": "Sr Dev",
//                 "cost_rate": 40,
//                 "total_hours": 150,
//                 "member_cost": 6000,
//                 "_id": "680b82812f2f323d364d1e40"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "cost_rate": 70,
//                 "total_hours": 50,
//                 "member_cost": 3500,
//                 "_id": "680b82812f2f323d364d1e41"
//               }
//             ],
//             "totalCosts": 9500
//           },
//           "revenueBreakdown": {
//             "memberRevenueBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Ram",
//                 "role": "Sr Dev",
//                 "billable_rate": 75,
//                 "billable_ratio": 90,
//                 "billable_hours": 135,
//                 "revenue": 10125,
//                 "_id": "680b82812f2f323d364d1e42"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "billable_rate": 90,
//                 "billable_ratio": 80,
//                 "billable_hours": 40,
//                 "revenue": 3600,
//                 "_id": "680b82812f2f323d364d1e43"
//               }
//             ],
//             "totalRevenue": 13725
//           },
//           "teamDailyCapacity": 8,
//           "projectedDuration": 25,
//           "projectedEndDate": "2025-06-04T00:00:00.000Z",
//           "averageBillableRatio": 85,
//           "teamCosts": 9500,
//           "mainRevenue": 15833.333333333334,
//           "profitLoss": 6333.333333333334,
//           "profitMargin": 40,
//           "_id": "680b82812f2f323d364d1e3f"
//         }
//       },
//       "_id": "680b82812f2f323d364d1e3b",
//       "__v": 0
//     },
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "projectDetails": {
//         "projectTitle": "Project A",
//         "projectDescription": "",
//         "projectinput": {
//           "startDate": "2025-05-05T00:00:00.000Z",
//           "workHours": 6,
//           "totalProjectHours": 300,
//           "profitTarget": 30,
//           "teamMemberCount": 3,
//           "workWeekDays": "5",
//           "teamMembers": [
//             {
//               "id": "memb1",
//               "name": "Syed",
//               "role": "Dev Head",
//               "department": "Engineer",
//               "hours_day": 5,
//               "cost_rate": 40,
//               "billable_rate": 50,
//               "billable_ratio": 100,
//               "_id": "680f8c2f6f5619a232b38c30"
//             },
//             {
//               "id": "memb2",
//               "name": "Danie",
//               "role": "Designer",
//               "department": "Design",
//               "hours_day": 2,
//               "cost_rate": 35,
//               "billable_rate": 40,
//               "billable_ratio": 100,
//               "_id": "680f8c2f6f5619a232b38c31"
//             },
//             {
//               "id": "memb3",
//               "name": "Sampurna",
//               "role": "Delivery Head",
//               "department": "Others",
//               "hours_day": 1,
//               "cost_rate": 60,
//               "billable_rate": 70,
//               "billable_ratio": 100,
//               "_id": "680f8c2f6f5619a232b38c32"
//             }
//           ],
//           "_id": "680f8c2f6f5619a232b38c2f"
//         },
//         "projectoutput": {
//           "teamCostBreakdown": {
//             "memberCostBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "cost_rate": 40,
//                 "total_hours": 187.5,
//                 "member_cost": 7500,
//                 "_id": "680f8c2f6f5619a232b38c34"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Danie",
//                 "role": "Designer",
//                 "cost_rate": 35,
//                 "total_hours": 75,
//                 "member_cost": 2625,
//                 "_id": "680f8c2f6f5619a232b38c35"
//               },
//               {
//                 "id": "memb3",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "cost_rate": 60,
//                 "total_hours": 37.5,
//                 "member_cost": 2250,
//                 "_id": "680f8c2f6f5619a232b38c36"
//               }
//             ],
//             "totalCosts": 12375
//           },
//           "revenueBreakdown": {
//             "memberRevenueBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "billable_rate": 50,
//                 "billable_ratio": 100,
//                 "billable_hours": 187.5,
//                 "revenue": 9375,
//                 "_id": "680f8c2f6f5619a232b38c37"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Danie",
//                 "role": "Designer",
//                 "billable_rate": 40,
//                 "billable_ratio": 100,
//                 "billable_hours": 75,
//                 "revenue": 3000,
//                 "_id": "680f8c2f6f5619a232b38c38"
//               },
//               {
//                 "id": "memb3",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "billable_rate": 70,
//                 "billable_ratio": 100,
//                 "billable_hours": 37.5,
//                 "revenue": 2625,
//                 "_id": "680f8c2f6f5619a232b38c39"
//               }
//             ],
//             "totalRevenue": 15000
//           },
//           "teamDailyCapacity": 8,
//           "projectedDuration": 37.5,
//           "projectedEndDate": "2025-06-25T00:00:00.000Z",
//           "averageBillableRatio": 100,
//           "teamCosts": 12375,
//           "mainRevenue": 17678.57142857143,
//           "profitLoss": 5303.571428571431,
//           "profitMargin": 30.00000000000001,
//           "_id": "680f8c2f6f5619a232b38c33"
//         }
//       },
//       "_id": "680f8c2f6f5619a232b38c2e",
//       "__v": 0
//     },
//     {
//       "userDetails": {
//         "fullname": "Radha-Astravue",
//         "email": "radha@astravue.com",
//         "password": "Vavanu89!"
//       },
//       "projectDetails": {
//         "projectTitle": "Project A",
//         "projectDescription": "",
//         "projectinput": {
//           "startDate": "2025-05-05T00:00:00.000Z",
//           "workHours": 6,
//           "totalProjectHours": 300,
//           "profitTarget": 30,
//           "teamMemberCount": 3,
//           "workWeekDays": "5",
//           "teamMembers": [
//             {
//               "id": "memb1",
//               "name": "Syed",
//               "role": "Dev Head",
//               "department": "Engineer",
//               "hours_day": 5,
//               "cost_rate": 40,
//               "billable_rate": 50,
//               "billable_ratio": 100,
//               "_id": "680f8c316f5619a232b38c55"
//             },
//             {
//               "id": "memb2",
//               "name": "Danie",
//               "role": "Designer",
//               "department": "Design",
//               "hours_day": 2,
//               "cost_rate": 35,
//               "billable_rate": 40,
//               "billable_ratio": 100,
//               "_id": "680f8c316f5619a232b38c56"
//             },
//             {
//               "id": "memb3",
//               "name": "Sampurna",
//               "role": "Delivery Head",
//               "department": "Others",
//               "hours_day": 1,
//               "cost_rate": 60,
//               "billable_rate": 70,
//               "billable_ratio": 100,
//               "_id": "680f8c316f5619a232b38c57"
//             }
//           ],
//           "_id": "680f8c316f5619a232b38c54"
//         },
//         "projectoutput": {
//           "teamCostBreakdown": {
//             "memberCostBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "cost_rate": 40,
//                 "total_hours": 187.5,
//                 "member_cost": 7500,
//                 "_id": "680f8c316f5619a232b38c59"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Danie",
//                 "role": "Designer",
//                 "cost_rate": 35,
//                 "total_hours": 75,
//                 "member_cost": 2625,
//                 "_id": "680f8c316f5619a232b38c5a"
//               },
//               {
//                 "id": "memb3",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "cost_rate": 60,
//                 "total_hours": 37.5,
//                 "member_cost": 2250,
//                 "_id": "680f8c316f5619a232b38c5b"
//               }
//             ],
//             "totalCosts": 12375
//           },
//           "revenueBreakdown": {
//             "memberRevenueBreakdown": [
//               {
//                 "id": "memb1",
//                 "name": "Syed",
//                 "role": "Dev Head",
//                 "billable_rate": 50,
//                 "billable_ratio": 100,
//                 "billable_hours": 187.5,
//                 "revenue": 9375,
//                 "_id": "680f8c316f5619a232b38c5c"
//               },
//               {
//                 "id": "memb2",
//                 "name": "Danie",
//                 "role": "Designer",
//                 "billable_rate": 40,
//                 "billable_ratio": 100,
//                 "billable_hours": 75,
//                 "revenue": 3000,
//                 "_id": "680f8c316f5619a232b38c5d"
//               },
//               {
//                 "id": "memb3",
//                 "name": "Sampurna",
//                 "role": "Delivery Head",
//                 "billable_rate": 70,
//                 "billable_ratio": 100,
//                 "billable_hours": 37.5,
//                 "revenue": 2625,
//                 "_id": "680f8c316f5619a232b38c5e"
//               }
//             ],
//             "totalRevenue": 15000
//           },
//           "teamDailyCapacity": 8,
//           "projectedDuration": 37.5,
//           "projectedEndDate": "2025-06-25T00:00:00.000Z",
//           "averageBillableRatio": 100,
//           "teamCosts": 12375,
//           "mainRevenue": 17678.57142857143,
//           "profitLoss": 5303.571428571431,
//           "profitMargin": 30.00000000000001,
//           "_id": "680f8c316f5619a232b38c58"
//         }
//       },
//       "_id": "680f8c316f5619a232b38c53",
//       "__v": 0
//     }
//   ];

export async function calculateCapacityDashboard(startInput, endInput, selectedDepartments, projectStatus, allprojectslist) {
const WORK_HOURS_PER_DAY = 8;
const DEFAULT_DEPARTMENTS = ['Engineer', 'Design', 'Product', 'Marketing', 'Others'];
const startTime = new Date(startInput);
const endTime = new Date(endInput);
const statusFilterMap = {
    "Approved": ["Approved"],
    "Cancelled": ["Cancelled", "Rejected"],
  };
// Utilities
function getBusinessDays(start, end) {
    let count = 0;
    let date = new Date(start);
    while (date <= end) {
    const day = date.getDay();
    if (day !== 0 && day !== 6) count++;
    date.setDate(date.getDate() + 1);
    }
    return count;
}

function getMonthsInRange(start, end) {
    const months = [];
    const startMonth = new Date(start.getFullYear(), start.getMonth(), 1);
    const endMonth = new Date(end.getFullYear(), end.getMonth(), 1);
    let current = new Date(startMonth);
  
    while (current <= endMonth) {
      // Use YYYY-MM-01 format to prevent overflow/underflow
      const year = current.getFullYear();
      const month = String(current.getMonth() + 1).padStart(2, '0');
      const safeDate = new Date(`${year}-${month}-01`);
      months.push(safeDate);
      current.setMonth(current.getMonth() + 1);
    }
    return months;
  }

function getDateOverlap(start1, end1, start2, end2) {
    const start = new Date(Math.max(start1.getTime(), start2.getTime()));
    const end = new Date(Math.min(end1.getTime(), end2.getTime()));
    return start <= end ? { start, end } : null;
}

const totalBusinessDays = getBusinessDays(startTime, endTime);

// ==== DepartmentCapacityRows ====
const departmentMap = {};
DEFAULT_DEPARTMENTS.forEach(dept => {
    departmentMap[dept] = {
    department: dept,
    capacityHrs: totalBusinessDays * WORK_HOURS_PER_DAY,
    allocatedHrs: 0,
    allocatedPercent: 0
    };
});

// ==== DeptartmentCapcityMonthRows ====
const months = getMonthsInRange(startTime, endTime);
const departmentMonthMap = {};
DEFAULT_DEPARTMENTS.forEach(dept => {
    departmentMonthMap[dept] = {};
    months.forEach(monthStart => {
    const key = monthStart.toISOString().slice(0, 7); // YYYY-MM
    departmentMonthMap[dept][key] = {
        days: 0,
        capacityHrs: 0,
        allocatedHrs: 0,
        allocatedPercent: 0
    };
    });
});

// ==== TeamMemberCapacityRows ====
const memberAllocMap = {};

// ==== ProjectTeamMemberCapacityRows ====
const memberProjectMap = {};

const allowedStatuses = statusFilterMap[projectStatus] || [];
allprojectslist = allprojectslist.filter(project => 
  allowedStatuses.includes(project.projectDetails.projectStatus)
);
allprojectslist.forEach(project => {
    const input = project.projectDetails.projectinput;
    const output = project.projectDetails.projectoutput;
    const overlap = getDateOverlap(startTime, endTime, new Date(input.startDate), new Date(output.projectedEndDate));
    if (!overlap) return;

    const activeDays = getBusinessDays(overlap.start, overlap.end);

    input.teamMembers.forEach(member => {
    const { name, department, hours_day } = member;

    // --- Dept Capacity Total
    if (departmentMap[department]) {
        departmentMap[department].allocatedHrs += hours_day * activeDays;
    }

    // --- Dept Capacity Month-Wise
    months.forEach(monthStart => {
        const monthEnd = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 0);
        const monthOverlap = getDateOverlap(overlap.start, overlap.end, monthStart, monthEnd);
        if (!monthOverlap) return;

        const key = monthStart.toISOString().slice(0, 7);
        const days = getBusinessDays(monthOverlap.start, monthOverlap.end);
        if (departmentMonthMap[department] && departmentMonthMap[department][key]) {
        departmentMonthMap[department][key].days += days;
        departmentMonthMap[department][key].capacityHrs += days * WORK_HOURS_PER_DAY;
        departmentMonthMap[department][key].allocatedHrs += hours_day * days;
        departmentMonthMap[department][key].allocatedPercent = Math.round((departmentMonthMap[department][key].allocatedHrs / departmentMonthMap[department][key].capacityHrs) * 100)
        }
    });

    // --- Team Member Capacity (only if department is selected)
    if (selectedDepartments.includes(department)) {
        if (!memberAllocMap[name]) memberAllocMap[name] = { allocatedHrs: 0 };
        memberAllocMap[name].allocatedHrs += hours_day * activeDays;
    }

    // --- Project Team Member Capacity
    if (!selectedDepartments.includes(department)) return;
    if (!memberProjectMap[name]) memberProjectMap[name] = [];
    const proj = memberProjectMap[name].find(p => p.projectName === project.projectDetails.projectTitle);
    if (proj) {
    proj.hrsTime += hours_day * activeDays;
    } else {
    memberProjectMap[name].push({
        projectName: project.projectDetails.projectTitle,
        hrsTime: hours_day * activeDays
    });
    }
    });
});

// Finalize DepartmentCapacityRows
const DepartmentCapacityRows = Object.values(departmentMap).map(d => ({
    ...d,
    availableHrs: Math.max(0, d.capacityHrs - d.allocatedHrs),
    allocatedPercent: Math.round((d.allocatedHrs / d.capacityHrs) * 100)
}));

// Finalize DeptartmentCapcityMonthRows
const DeptartmentCapcityMonthRows = Object.entries(departmentMonthMap).map(([department, monthData]) => {
    const months = Object.entries(monthData)
    .sort(([a], [b]) => new Date(a) - new Date(b))
    .map(([key, val]) => ({
        monthName: new Date(key + "-01").toLocaleString('default', { month: 'long', year: 'numeric' }),
        ...val
    }));
    return { department, months };
});

// Finalize TeamMemberCapacityRows
const TeamMemberCapacityRows = Object.entries(memberAllocMap).map(([name, data]) => {
    const capacityHrs = totalBusinessDays * WORK_HOURS_PER_DAY;
    return {
    memberName: name,
    capacityHrs,
    allocatedHrs: data.allocatedHrs,
    availableHrs: Math.max(0, capacityHrs - data.allocatedHrs),
    allocatedPercent: Math.round((data.allocatedHrs / capacityHrs) * 100)
    };
});

// Finalize ProjectTeamMemberCapacityRows
const ProjectTeamMemberCapacityRows = Object.entries(memberProjectMap).map(([name, projectList]) => ({
    memberName: name,
    allocatedProjectHrs: projectList
}));

return {
    DepartmentCapacityRows,
    DeptartmentCapcityMonthRows,
    TeamMemberCapacityRows,
    ProjectTeamMemberCapacityRows
};
}

// const startTime = "2025-02-21";
// const endTime = "2026-07-24";
// const departments = ['Engineer', 'Design', 'Others'];
// const result = calculateCapacityDashboard(startTime,endTime,departments,allprojectslist);
// console.log(JSON.stringify(result, null, 2));
